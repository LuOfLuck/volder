{% extends 'profesor/base.html' %}
{% load static %}
{% block content %}

<div class=" mid-contenido-animacion col-12 col-md-9 mx-auto my-4 px-4">
    <div class="row">
        {% for respuesta in respuestas %}
                
               <!-- 
                    gracias por testear la pagina, si estas leyendo esto pliss escribe en mi instagram @lugically_cosmic2.2
                    y mostrame, te lo agradeceria mucho.

                    esto lo estoy escribiendo el 17/07/2021 el dia en el que probaremos la pagina en la escuela E.E.S.T NÂ°14 
                    por primera ves

                    Hacer todo esto no es facil <3
                    
                -->
                <div id="trabajo-{{respuesta.id}}" class="trabajo trabajos-animacion col-10 p-3 my-2 ml-4"> 
                    <div class="trabajo--titulo">
                        <h4 class="titulo--nombre">{{respuesta.estudiante}}</h4>
                    </div>           
                    <p class="trabajo--p">  {{respuesta.comentario}}  </p>
                    <p><span >entregado el: </span> {{respuesta.create}}</p>
                    <div class="trabajo--end">
                        <a id="button-{{respuesta.id}}" href="{{respuesta.archivo.url}}" target="_BLANK" class="btn">Descargar respuestas</a>
                    </div>
                </div>   
                <script> 
                var mostraBoton = true;
                
                {% for nota in notas %}
                    console.log("{{nota.respuestaTrabajo.estudiante}}")
                    if ("{{nota.respuestaTrabajo}}" == "{{respuesta.estudiante}}"){
                        mostraBoton = false;
                        button = document.getElementById("button-{{respuesta.id}}");
                      
                        div = document.getElementById("trabajo-{{respuesta.id}}");
                        if("{{nota.nota}}" > 6){
                            button.classList += "  btn-outline-success";
                            div.classList += " aprobado";
                            div.innerHTML += `<button class="btn btn-outline-success float-right">Nota: {{nota.nota}}</button>`;
                        }
                        else{
                            button.classList += "  btn-outline-danger";
                            div.classList += " desaprobado";
                            div.innerHTML += `<button class="btn btn-outline-danger float-right">Nota: {{nota.nota}}</button>`;
                        }
                    }
                    {% if forloop.last %}
                        
                            console.log("{{respuesta.id}}" + mostraBoton)
                            if(mostraBoton == true){
                                let div = document.getElementById("trabajo-{{respuesta.id}}")
                                div.innerHTML += `<button onclick="popouAbrir({{respuesta.estudiante.id}})" class="btn btn-outline-primary float-right">calificar</button>`;
                            }
                    {% endif %}

                {% empty %}
                    div = document.getElementById("trabajo-{{respuesta.id}}");
                    div.innerHTML += `<button onclick="popouAbrir({{respuesta.estudiante.id}})" class="btn btn-outline-primary float-right">calificar</button>`
                {% endfor %}
                </script>
        {% endfor %}

        
    </div>
</div>

<div id="cont" class="popou"></div>

<script>
    let cont = document.getElementById("cont");
    let inconCerrar = document.getElementById("cerrar-popou");
    function cerrarPopou(){
        cont.style.display ="none";
        cont.innerHTML = "";
    }

    function popouAbrir(id_estudiante){
        cont.style.display ="flex";
        cont.innerHTML = `
        <div class="popou-cont col-11 col-md-6 pb-4 px-4 pt-4">

            <h3 class=" text-center">Calificar trabajo</h3><i id="cerrar-popou" onclick="cerrarPopou()" class="far fa-times-circle cerrar-poput"></i><hr>

            <form action="" method="POST" class="formulario-publicacion" > {% csrf_token %}

                <div class="row">
                
                    <div class="col-6 mx-auto">

                        {{form.comentario}}

                    </div>
                </div>
                <div class="row my-3">
                    <div class="col-8 col-md-5 m-auto">
                        {{form.nota}}
                    </div>
                    <input type="text" class="invisible" name="id_estudiante" value="${id_estudiante}" readonly>
                    <div class="col-3 m-auto">
                        <input type="submit" class="m-auto btn btn-outline-primary" value="Califiacar">    
                    </div>
                </div>
            </form>
        </div>

        `;
    }
</script>


{% endblock %}